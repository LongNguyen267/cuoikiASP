@model IEnumerable<GameStore.Models.Product>

@{
    ViewData["Title"] = "Sản phẩm";
}

@* Nạp file CSS cho trang sản phẩm *@
@section Styles {
    <link rel="stylesheet" href="~/css/products.css" asp-append-version="true" />
}

@* ================================================== *@
@* === PHẦN 1: HERO SECTION (Ảnh PS5 full màn hình) === *@
@* ================================================== *@
<section class="hero-product-page">
    <div class="split-hero-container">
        <div class="text-overlay-box">
            <h2>Khám Phá Thế Giới Game Đỉnh Cao Cùng PlayStation 5</h2>
            <p>Trải nghiệm tốc độ với ổ cứng SSD siêu nhanh và đắm chìm trong thế giới game sống động với đồ họa tuyệt đẹp.</p>
        </div>
        <img class="main-hero-image" src="/image/product/ps5products.jpg" alt="PS5">
        <div class="product-overlay-box">
            <p class="box-title">Sản phẩm nổi bật</p>
            <a href="#" class="featured-product-link">
                <img class="featured-product-image" src="/image/product/ps5taycam.jpg" alt="PS5 Controller">
                <div class="featured-product-info">
                    <p class="product-name">PlayStation 5 Console</p>
                    <p class="product-price">
                        <span>14,990,000đ</span>
                    </p>
                </div>
            </a>
        </div>
    </div>
</section>


@* ================================================== *@
@* === PHẦN 2: DANH SÁCH SẢN PHẨM (Giao diện mới) === *@
@* ================================================== *@
<div class="product-page-container">

    @* --- Breadcrumb (Thanh điều hướng) --- *@
    <nav class="breadcrumb">
        <a asp-controller="Home" asp-action="Index">Trang chủ</a>
        <span>/</span>
        <a asp-controller="Products" asp-action="Index">Sản phẩm</a>
    </nav>

    @* --- Tiêu đề trang --- *@
    <h1 class="page-title">MÁY GAME</h1>

    @* --- Bộ lọc theo loại sản phẩm (Icon) --- *@
    <div class="category-icon-filter">
        <h3>Loại</h3>
        <div class="category-icon-list">

            <a asp-controller="Products" asp-action="Index" class="category-icon-item">
                <img src="https://i.imgur.com/example-all-icon.png" alt="Tất cả" /> <span>Tất cả</span>
            </a>

            <a asp-controller="Products" asp-action="Index" asp-route-searchQuery="PS5" class="category-icon-item">
                <img src="https://i.imgur.com/rXy2x4j.png" alt="PS5" />
                <span>PS5</span>
            </a>
            <a asp-controller="Products" asp-action="Index" asp-route-searchQuery="PS4" class="category-icon-item">
                <img src="https://i.imgur.com/rXy2x4j.png" alt="PS4" />
                <span>PS4</span>
            </a>
            <a asp-controller="Products" asp-action="Index" asp-route-searchQuery="Nintendo" class="category-icon-item">
                <img src="https://i.imgur.com/bV4B4E7.png" alt="Nintendo" />
                <span>Nintendo</span>
            </a>
            <a asp-controller="Products" asp-action="Index" asp-route-searchQuery="Xbox" class="category-icon-item">
                <img src="https://i.imgur.com/eG1M9dJ.png" alt="Xbox" />
                <span>Xbox</span>
            </a>
            <a asp-controller="Products" asp-action="Index" asp-route-searchQuery="Handheld PC" class="category-icon-item">
                <img src="https://i.imgur.com/YqN4k3g.png" alt="Handheld PC" />
                <span>Handheld PC</span>
            </a>
            <a asp-controller="Products" asp-action="Index" asp-route-searchQuery="Miyoo" class="category-icon-item">
                <img src="https://i.imgur.com/nJ5g9mC.png" alt="Retro" />
                <span>Retro</span>
            </a>
        </div>
    </div>

    @* --- Thanh công cụ (Hiển thị, sắp xếp) --- *@
    <div class="product-toolbar">
        <div class="product-count-info">
            Hiển thị @Model.Count() kết quả
        </div>
        <div class="product-sort-options">
            <label for="sort-by">Sắp xếp:</label>
            <select id="sort-by" name="sort-by">
                <option value="default">Mặc định</option>
                <option value="price-asc">Giá tăng dần</option>
                <option value="price-desc">Giá giảm dần</option>
            </select>
        </div>
    </div>

@* --- Lưới hiển thị sản phẩm --- *@
    <div id="productGridContainer">
        @await Html.PartialAsync("_ProductGridPartial", Model)
    </div>
@section Scripts {
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Lấy các element cần thiết
                const filterLinks = document.querySelectorAll('.category-icon-item');
                const sortSelect = document.getElementById('sort-by');
                const productGridContainer = document.getElementById('productGridContainer');
                const productCountInfo = document.querySelector('.product-count-info');

                // Lưu trữ trạng thái lọc và sắp xếp hiện tại
                let currentSearchQuery = '';
                let currentSortOrder = 'default';

                // Hàm chính để gọi AJAX và cập nhật sản phẩm
                function fetchProducts() {
                    // Xây dựng URL với cả hai tham số
                    let url = `@Url.Action("Index", "Products")?searchQuery=${encodeURIComponent(currentSearchQuery)}&sortOrder=${currentSortOrder}`;

                    fetch(url, {
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    })
                    .then(response => response.text())
                    .then(html => {
                        // Cập nhật lại lưới sản phẩm
                        productGridContainer.innerHTML = html;

                        // Cập nhật lại số lượng kết quả (bonus)
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = html;
                        const count = tempDiv.querySelectorAll('.product-card').length;
                        productCountInfo.textContent = `Hiển thị ${count} kết quả`;
                    })
                    .catch(error => console.error('Error fetching products:', error));
                }

                // Gán sự kiện cho các nút lọc
                filterLinks.forEach(link => {
                    link.addEventListener('click', function (event) {
                        event.preventDefault();

                        // Cập nhật searchQuery và gọi hàm fetch
                        const url = new URL(this.href);
                        currentSearchQuery = url.searchParams.get('searchQuery') || '';
                        fetchProducts();

                        // Cập nhật trạng thái 'active'
                        filterLinks.forEach(l => l.classList.remove('active'));
                        this.classList.add('active');
                    });
                });

                // Gán sự kiện cho dropdown sắp xếp
                sortSelect.addEventListener('change', function () {
                    // Cập nhật sortOrder và gọi hàm fetch
                    currentSortOrder = this.value;
                    fetchProducts();
                });
            });
        </script>
}
